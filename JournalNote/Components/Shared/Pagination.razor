@using JournalNote.Models

<div class="pagination-container">
    <div class="pagination-info">
        <span>
            Showing @PaginationInfo.StartItem-@PaginationInfo.EndItem of @PaginationInfo.TotalItems
        </span>
    </div>

    <nav aria-label="Page navigation">
        <ul class="pagination">
            <li class="page-item @(IsFirstPage ? "disabled" : "")">
                <button class="page-link"
                        @onclick="() => OnPageChanged(1)"
                        disabled="@IsFirstPage">
                    ««
                </button>
            </li>

            <li class="page-item @(!PaginationInfo.HasPreviousPage ? "disabled" : "")">
                <button class="page-link"
                        @onclick="() => OnPageChanged(PaginationInfo.CurrentPage - 1)"
                        disabled="@(!PaginationInfo.HasPreviousPage)">
                    «
                </button>
            </li>

            <li class="page-item @(!PaginationInfo.HasNextPage ? "disabled" : "")">
                <button class="page-link"
                        @onclick="() => OnPageChanged(PaginationInfo.CurrentPage + 1)"
                        disabled="@(!PaginationInfo.HasNextPage)">
                    »
                </button>
            </li>

            <li class="page-item @(IsLastPage ? "disabled" : "")">
                <button class="page-link"
                        @onclick="() => OnPageChanged(PaginationInfo.TotalPages)"
                        disabled="@IsLastPage">
                    »»
                </button>
            </li>
        </ul>
    </nav>
    @foreach (var page in GetPageNumbers())
    {
        <li class="page-item @(page == PaginationInfo.CurrentPage ? "active" : "")">
            <button class="page-link" @onclick="() => OnPageChanged(page)">
                @page
            </button>
        </li>
    }

    <div class="page-size-selector">
        <label>Items per page:</label>
        <select class="form-select form-select-sm" @onchange="OnPageSizeChanged">
            <option value="5" selected="@(PageSize == 5)">5</option>
            <option value="10" selected="@(PageSize == 10)">10</option>
            <option value="15" selected="@(PageSize == 15)">15</option>
            <option value="20" selected="@(PageSize == 20)">20</option>
            <option value="50" selected="@(PageSize == 50)">50</option>
        </select>
    </div>

</div>

@code {
    [Parameter]
    public int PageSize { get; set; } = 10;

    [Parameter]
    public EventCallback<int> OnPageSizeChange { get; set; }

    private async Task OnPageSizeChanged(ChangeEventArgs e)
    {
        if (e?.Value == null)
            return;

        if (int.TryParse(e.Value.ToString(), out var newSize))
        {
            await OnPageSizeChange.InvokeAsync(newSize);
        }
    }

    [Parameter]
    public PaginationInfo PaginationInfo { get; set; } = new PaginationInfo(1, 10, 0);

    [Parameter]
    public EventCallback<int> OnPageChange { get; set; }

    private bool IsFirstPage => PaginationInfo.CurrentPage <= 1;
    private bool IsLastPage => PaginationInfo.CurrentPage >= PaginationInfo.TotalPages;

    private async Task OnPageChanged(int pageNumber)
    {
        if (pageNumber < 1 || pageNumber > PaginationInfo.TotalPages)
            return;

        await OnPageChange.InvokeAsync(pageNumber);
    }
    private List<int> GetPageNumbers()
    {
        var pages = new List<int>();
        var total = PaginationInfo.TotalPages;
        var current = PaginationInfo.CurrentPage;

        if (total <= 7)
        {
            for (int i = 1; i <= total; i++)
                pages.Add(i);

            return pages;
        }

        pages.Add(1);

        if (current > 3)
            pages.Add(-1);

        for (int i = Math.Max(2, current - 1); i <= Math.Min(total - 1, current + 1); i++)
            pages.Add(i);

        if (current < total - 2)
            pages.Add(-1);

        pages.Add(total);

        return pages;
    }


}
