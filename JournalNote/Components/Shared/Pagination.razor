@using JournalNote.Models

<div class="pagination-container">
    <div class="pagination-info">
        <span>Showing @PaginationInfo.StartItem-@PaginationInfo.EndItem of @PaginationInfo.TotalItems</span>
    </div>

    <nav aria-label="Page navigation">
        <ul class="pagination">
            <!-- First Page -->
            <li class="page-item @(PaginationInfo.CurrentPage == 1 ? "disabled" : "")">
                <button class="page-link" @onclick="() => OnPageChanged(1)" disabled="@(PaginationInfo.CurrentPage == 1)">
                    ««
                </button>
            </li>

            <!-- Previous Page -->
            <li class="page-item @(! PaginationInfo.HasPreviousPage ? "disabled" : "")">
                <button class="page-link" @onclick="() => OnPageChanged(PaginationInfo.CurrentPage - 1)" 
                        disabled="@(! PaginationInfo.HasPreviousPage)">
                    «
                </button>
            </li>

            <!-- Page Numbers -->
            @foreach (var pageNumber in GetPageNumbers())
            {
                <li class="page-item @(pageNumber == PaginationInfo.CurrentPage ? "active" : "")">
                    <button class="page-link" @onclick="() => OnPageChanged(pageNumber)">
                        @pageNumber
                    </button>
                </li>
            }

            <!-- Next Page -->
            <li class="page-item @(!PaginationInfo.HasNextPage ? "disabled" : "")">
                <button class="page-link" @onclick="() => OnPageChanged(PaginationInfo.CurrentPage + 1)" 
                        disabled="@(!PaginationInfo.HasNextPage)">
                    »
                </button>
            </li>

            <!-- Last Page -->
            <li class="page-item @(PaginationInfo.CurrentPage == PaginationInfo.TotalPages ? "disabled" : "")">
                <button class="page-link" @onclick="() => OnPageChanged(PaginationInfo.TotalPages)" 
                        disabled="@(PaginationInfo.CurrentPage == PaginationInfo.TotalPages)">
                    »»
                </button>
            </li>
        </ul>
    </nav>

    <div class="page-size-selector">
        <label>Items per page:</label>
        <select class="form-select form-select-sm" @onchange="OnPageSizeChanged">
            <option value="5" selected="@(PageSize == 5)">5</option>
            <option value="10" selected="@(PageSize == 10)">10</option>
            <option value="15" selected="@(PageSize == 15)">15</option>
            <option value="20" selected="@(PageSize == 20)">20</option>
            <option value="50" selected="@(PageSize == 50)">50</option>
        </select>
    </div>
</div>

@code {
    [Parameter]
    public PaginationInfo PaginationInfo { get; set; }

    [Parameter]
    public int PageSize { get; set; } = 10;

    [Parameter]
    public EventCallback<int> OnPageChange { get; set; }

    [Parameter]
    public EventCallback<int> OnPageSizeChange { get; set; }

    private async Task OnPageChanged(int pageNumber)
    {
        if (pageNumber >= 1 && pageNumber <= PaginationInfo.TotalPages)
        {
            await OnPageChange.InvokeAsync(pageNumber);
        }
    }

    private async Task OnPageSizeChanged(ChangeEventArgs e)
    {
        if (int.TryParse(e.Value?.ToString(), out int newPageSize))
        {
            await OnPageSizeChange.InvokeAsync(newPageSize);
        }
    }

    private List<int> GetPageNumbers()
    {
        var pageNumbers = new List<int>();
        var totalPages = PaginationInfo.TotalPages;
        var currentPage = PaginationInfo.CurrentPage;

        if (totalPages <= 7)
        {
            // Show all pages
            for (int i = 1; i <= totalPages; i++)
            {
                pageNumbers.Add(i);
            }
        }
        else
        {
            // Show first, last, current, and nearby pages
            pageNumbers.Add(1);

            if (currentPage > 3)
            {
                pageNumbers.Add(-1); // Ellipsis placeholder
            }

            for (int i = Math.Max(2, currentPage - 1); i <= Math.Min(totalPages - 1, currentPage + 1); i++)
            {
                if (! pageNumbers.Contains(i))
                {
                    pageNumbers.Add(i);
                }
            }

            if (currentPage < totalPages - 2)
            {
                pageNumbers.Add(-1); // Ellipsis placeholder
            }

            if (! pageNumbers.Contains(totalPages))
            {
                pageNumbers.Add(totalPages);
            }
        }

        return pageNumbers;
    }
}