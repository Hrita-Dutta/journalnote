@inherits LayoutComponentBase

<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>

    <main>
        <div class="top-row px-4">
            <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a>
        </div>

        <article class="content px-4">
            <SecurityGuard>
                @Body
            </SecurityGuard>
        </article>
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">🗙</a>
</div>

@* @inherits LayoutComponentBase *@
@* @using JournalNote.Services *@
@* @inject ThemeService ThemeService *@
@* @implements IDisposable *@
@* *@
@* <div class="page" data-theme="@(isDarkMode ? "dark" : "light")"> *@
@*     <div class="sidebar"> *@
@*         <NavMenu /> *@
@*     </div> *@
@* *@
@*     <main> *@
@*         <div class="top-row px-4"> *@
@*             <a href="https://learn.microsoft.com/aspnet/core/" target="_blank">About</a> *@
@*         </div> *@
@* *@
@*         <article class="content px-4"> *@
@*             @Body *@
@*         </article> *@
@*     </main> *@
@* </div> *@
@* *@
@* <div id="blazor-error-ui"> *@
@*     An unhandled error has occurred. *@
@*     <a href="" class="reload">Reload</a> *@
@*     <a class="dismiss">🗙</a> *@
@* </div> *@
@* *@
@* @code { *@
@*     private bool isDarkMode = false; *@
@*     private bool isInitialized = false; *@
@* *@
@*     protected override async Task OnInitializedAsync() *@
@*     { *@
@*         try *@
@*         { *@
@*             await InitializeTheme(); *@
@*             ThemeService.ThemeChanged += OnThemeChanged; *@
@*         } *@
@*         catch (Exception ex) *@
@*         { *@
@*             System.Diagnostics.Debug.WriteLine($"Error in MainLayout initialization: {ex.Message}"); *@
@*         } *@
@*     } *@
@* *@
@*     protected override async Task OnAfterRenderAsync(bool firstRender) *@
@*     { *@
@*         if (firstRender && !isInitialized) *@
@*         { *@
@*             try *@
@*             { *@
@*                 await InitializeTheme(); *@
@*                 isInitialized = true; *@
@*                 StateHasChanged(); *@
@*             } *@
@*             catch (Exception ex) *@
@*             { *@
@*                 System.Diagnostics.Debug.WriteLine($"Error in OnAfterRenderAsync: {ex.Message}"); *@
@*             } *@
@*         } *@
@*     } *@
@* *@
@*     private async Task InitializeTheme() *@
@*     { *@
@*         try *@
@*         { *@
@*             isDarkMode = await ThemeService.GetIsDarkModeAsync(); *@
@*             await ThemeService.InitializeThemeAsync(); *@
@*         } *@
@*         catch (Exception ex) *@
@*         { *@
@*             System.Diagnostics.Debug.WriteLine($"Error initializing theme: {ex.Message}"); *@
@*             isDarkMode = false; // Fallback to light mode *@
@*         } *@
@*     } *@
@* *@
@*     private void OnThemeChanged(object sender, EventArgs e) *@
@*     { *@
@*         InvokeAsync(async () => *@
@*         { *@
@*             try *@
@*             { *@
@*                 isDarkMode = await ThemeService.GetIsDarkModeAsync(); *@
@*                 StateHasChanged(); *@
@*             } *@
@*             catch (Exception ex) *@
@*             { *@
@*                 System.Diagnostics.Debug.WriteLine($"Error in OnThemeChanged: {ex.Message}"); *@
@*             } *@
@*         }); *@
@*     } *@
@* *@
@*     public void Dispose() *@
@*     { *@
@*         ThemeService.ThemeChanged -= OnThemeChanged; *@
@*     } *@
@* } *@